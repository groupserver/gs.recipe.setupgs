=====================
``gs.recipe.setupgs``
=====================
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A ``zc.buildout`` recipe for setting up a GroupServer instance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:Author: `Michael JasonSmith`_
:Contact: Michael JasonSmith <mpj17@onlinegroups.net>
:Date: 2014-05-16
:Organization: `GroupServer.org`_
:Copyright: This document is licensed under a
  `Creative Commons Attribution-Share Alike 4.0 International License`_
  by `OnlineGroups.net`_.

Introduction
============

This product supplies a ``zc_buildout`` [#buildout]_ recipe_ for
installing a GroupServer site in a Zope instance.

Recipe
======

The recipe installs GroupServer in two stages.

#. Generates a script based on the configuration_.
#. Runs the script_ with the correct python environment for
   Zope (the ``instancepython``).

The reason for this convoluted process is to allow the script_ to
start Zope, and call code within it. The recipe is only run once
because of a `lock file`_.

Configuration
-------------

The options for this recipe are specified in the ``confg.cfg`` file, and
are marshalled by the ``instance.cfg`` configuration file. 

``zope_admin_name``:
  The name of the Zope administrator

``instance_id'``:
  The ID of the new GroupServer instance.

``instance_title``:
  The title of the new GroupServer instance.

``support_email``:
  The email address to contact for support.

``gs_admin_email``:
  The email address of the new GroupServer administrator, who is
  created with the site.

``gs_admin_password``:
  The password for the new GroupServer administrator.

``gs_host``:
  The host-name for the new site.

``gs_port``:
  The port for the new site.

``gs_smtp_host``:
  The host-name for the *outgoing* SMTP server.

``gs_smtp_port``:
  The port-number for the *outgoing* SMTP server.

``gs_smtp_user``:
  The user-name for the *outgoing* SMTP server.

``gs_smtp_password``:
  The password for the *outgoing* SMTP server.


Script
------

The script is defined by the template ``script.py_tmpl`` in this
product. The recipe substitutes the configuration_ into the
script, and then executes the script by calling::

  bin/instance run scriptName

This starts the Zope instance, and runs the script within
Zope. (The script-name is generated by ``tempfile``.) The script
then sets up GroupServer by calling code in
``Products.GroupServer.create`` [#pgs]_.

Lock file
---------

The recipe will not be run if the lock-file ``setup-gs.cfg`` is
present in the ``var`` directory. To run this recipe more than
once either delete the lock file, or in the configuration set::

  run-once = False

Acknowledgements
================

Many thanks to the ``collective.recipe.updateplone`` [#update]_ authors for
inspiring this product.

Resources
=========

- Code repository: https://source.iopen.net/groupserver/gs.group.recipe.setupgs
- Questions and comments to http://groupserver.org/groups/development
- Report bugs at https://redmine.iopen.net/projects/groupserver

.. [#buildout] See <https://pypi.python.org/pypi/zc.buildout/2.2.1>
.. [#update] See <https://pypi.python.org/pypi/collective.recipe.updateplone/0.3>
.. [#pgs] See <https://source.iopen.net/groupserver/Products.GroupServer>
.. _GroupServer: http://groupserver.org/
.. _GroupServer.org: http://groupserver.org/
.. _OnlineGroups.Net: https://onlinegroups.net
.. _Michael JasonSmith: http://groupserver.org/p/mpj17
..  _Creative Commons Attribution-Share Alike 4.0 International License:
    http://creativecommons.org/licenses/by-sa/4.0/
